import*as Bindings from"../bindings/bindings.js";import*as Common from"../common/common.js";import*as Components from"../components/components.js";import*as Host from"../host/host.js";import*as InlineEditor from"../inline_editor/inline_editor.js";import*as SDK from"../sdk/sdk.js";import*as TextUtils from"../text_utils/text_utils.js";import*as UI from"../ui/ui.js";import{ColorSwatchPopoverIcon,ShadowSwatchPopoverHelper}from"./ColorSwatchPopoverIcon.js";import{linkifyDeferredNodeReference}from"./DOMLinkifier.js";import{ElementsSidebarPane}from"./ElementsSidebarPane.js";import{ImagePreviewPopover}from"./ImagePreviewPopover.js";import{StylePropertyHighlighter}from"./StylePropertyHighlighter.js";import{StylePropertyTreeElement}from"./StylePropertyTreeElement.js";import{Context}from"./StylePropertyTreeElement.js";export class StylesSidebarPane extends ElementsSidebarPane{constructor(){super(!0),this.setMinimumSize(96,26),this.registerRequiredCSS("elements/stylesSidebarPane.css"),Common.Settings.Settings.instance().moduleSetting("colorFormat").addChangeListener(this.update.bind(this)),Common.Settings.Settings.instance().moduleSetting("textEditorIndent").addChangeListener(this.update.bind(this)),this._currentToolbarPane=null,this._animatedToolbarPane=null,this._pendingWidget=null,this._pendingWidgetToggle=null,this._toolbarPaneElement=this._createStylesSidebarToolbar(),this._noMatchesElement=this.contentElement.createChild("div","gray-info-message hidden"),this._noMatchesElement.textContent=ls`No matching selector or style`,this._sectionsContainer=this.contentElement.createChild("div"),UI.ARIAUtils.markAsTree(this._sectionsContainer),this._sectionsContainer.addEventListener("keydown",this._sectionsContainerKeyDown.bind(this),!1),this._sectionsContainer.addEventListener("focusin",this._sectionsContainerFocusChanged.bind(this),!1),this._sectionsContainer.addEventListener("focusout",this._sectionsContainerFocusChanged.bind(this),!1),this._swatchPopoverHelper=new InlineEditor.SwatchPopoverHelper.SwatchPopoverHelper,this._linkifier=new Components.Linkifier.Linkifier(_maxLinkLength,!0),this._decorator=null,this._userOperation=!1,this._isEditingStyle=!1,this._filterRegex=null,this._isActivePropertyHighlighted=!1,this.contentElement.classList.add("styles-pane"),this._sectionBlocks=[],this._needsForceUpdate=!1,StylesSidebarPane._instance=this,self.UI.context.addFlavorChangeListener(SDK.DOMModel.DOMNode,this.forceUpdate,this),this.contentElement.addEventListener("copy",this._clipboardCopy.bind(this)),this._resizeThrottler=new Common.Throttler.Throttler(100),this._imagePreviewPopover=new ImagePreviewPopover(this.contentElement,e=>{const t=e.composedPath()[0];return t instanceof Element?t:null},()=>this.node())}swatchPopoverHelper(){return this._swatchPopoverHelper}setUserOperation(e){this._userOperation=e}static createExclamationMark(e){const t=createElement("span","dt-icon-label");return t.className="exclamation-mark",StylesSidebarPane.ignoreErrorsForProperty(e)||(t.type="smallicon-warning"),t.title=SDK.CSSMetadata.cssMetadata().isCSSPropertyName(e.name)?Common.UIString.UIString("Invalid property value"):Common.UIString.UIString("Unknown property name"),t}static ignoreErrorsForProperty(e){function t(e){return!e.startsWith("-webkit-")&&/^[-_][\w\d]+-\w/.test(e)}const i=e.name.toLowerCase();if("_"===i.charAt(0))return!0;if("filter"===i)return!0;if(i.startsWith("scrollbar-"))return!0;if(t(i))return!0;const s=e.value.toLowerCase();return!!s.endsWith("\\9")||!!t(s)}static createPropertyFilterElement(e,t,i){const s=createElementWithClass("input");function n(){const e=s.value?new RegExp(s.value.escapeForRegExp(),"i"):null;i(e)}return s.placeholder=e,s.addEventListener("input",n,!1),s.addEventListener("keydown",(function(e){"Escape"===e.key&&s.value&&(e.consume(!0),s.value="",n())}),!1),s.setFilterValue=function(e){s.value=e,s.focus(),n()},s}revealProperty(e){this._decorator=new StylePropertyHighlighter(this,e),this._decorator.perform(),this.update()}forceUpdate(){this._needsForceUpdate=!0,this._swatchPopoverHelper.hide(),this._resetCache(),this.update()}_sectionsContainerKeyDown(e){const t=this._sectionsContainer.ownerDocument.deepActiveElement();if(!t)return;const i=t._section;if(i)switch(e.key){case"ArrowUp":case"ArrowLeft":(i.previousSibling()||i.lastSibling()).element.focus(),e.consume(!0);break;case"ArrowDown":case"ArrowRight":(i.nextSibling()||i.firstSibling()).element.focus(),e.consume(!0);break;case"Home":i.firstSibling().element.focus(),e.consume(!0);break;case"End":i.lastSibling().element.focus(),e.consume(!0)}}_sectionsContainerFocusChanged(){this.resetFocus()}resetFocus(){this._sectionBlocks[0]&&this._sectionBlocks[0].sections[0]&&(this._sectionBlocks[0].sections[0].element.tabIndex=this._sectionsContainer.hasFocus()?-1:0)}_onAddButtonLongClick(e){const t=this.cssModel();if(!t)return;const i=t.styleSheetHeaders().filter((function(e){return!e.isViaInspector()&&!e.isInline&&!!e.resourceURL()})),s=[];for(let e=0;e<i.length;++e){const t=i[e],n=this._createNewRuleInStyleSheet.bind(this,t);s.push({text:Bindings.ResourceUtils.displayNameForURL(t.resourceURL()),handler:n})}s.sort((function(e,t){return String.naturalOrderComparator(e.text,t.text)}));const n=new UI.ContextMenu.ContextMenu(e);for(let e=0;e<s.length;++e){const t=s[e];n.defaultSection().appendItem(t.text,t.handler)}n.footerSection().appendItem("inspector-stylesheet",this._createNewRuleInViaInspectorStyleSheet.bind(this)),n.show()}_onFilterChanged(e){this._filterRegex=e,this._updateFilter()}_refreshUpdate(e,t){if(t)for(const e of this.allSections())e.isBlank||e._updateVarFunctions(t);if(this._isEditingStyle)return;const i=this.node();if(i){for(const t of this.allSections())t.isBlank||t.update(t===e);this._filterRegex&&this._updateFilter(),this._nodeStylesUpdatedForTest(i,!1)}}doUpdate(){return this._fetchMatchedCascade().then(this._innerRebuildUpdate.bind(this))}onResize(){this._resizeThrottler.schedule(this._innerResize.bind(this))}_innerResize(){const e=this.contentElement.getBoundingClientRect().width+"px";return this.allSections().forEach(t=>t.propertiesTreeOutline.element.style.width=e),Promise.resolve()}_resetCache(){this.cssModel()&&this.cssModel().discardCachedMatchedCascade()}_fetchMatchedCascade(){const e=this.node();return e&&this.cssModel()?this.cssModel().cachedMatchedCascadeForNode(e).then(function(e){return e&&e.node()===this.node()?e:null}.bind(this)):Promise.resolve(null)}setEditingStyle(e,t){this._isEditingStyle!==e&&(this.contentElement.classList.toggle("is-editing-style",e),this._isEditingStyle=e,this._setActiveProperty(null))}_setActiveProperty(e){if(this._isActivePropertyHighlighted&&SDK.OverlayModel.OverlayModel.hideDOMNodeHighlight(),this._isActivePropertyHighlighted=!1,!this.node())return;if(!e||e.overloaded()||e.inherited())return;const t=e.property.ownerStyle.parentRule,i=t instanceof SDK.CSSRule.CSSStyleRule?t.selectorText():void 0;for(const t of["padding","border","margin"])if(e.name.startsWith(t)){this.node().domModel().overlayModel().highlightInOverlay({node:this.node(),selectorList:i},t),this._isActivePropertyHighlighted=!0;break}}onCSSModelChanged(e){const t=e&&e.data?e.data.edit:null;if(t)for(const e of this.allSections())e._styleSheetEdited(t);else this._userOperation||this._isEditingStyle||(this._resetCache(),this.update())}focusedSectionIndex(){let e=0;for(const t of this._sectionBlocks)for(const i of t.sections){if(i.element.hasFocus())return e;e++}return-1}continueEditingElement(e,t){const i=this.allSections()[e];i&&i.propertiesTreeOutline.rootElement().childAt(t).startEditing()}async _innerRebuildUpdate(e){if(this._needsForceUpdate)this._needsForceUpdate=!1;else if(this._isEditingStyle||this._userOperation)return;const t=this.focusedSectionIndex();this._linkifier.reset(),this._sectionsContainer.removeChildren(),this._sectionBlocks=[];const i=this.node();if(!e||!i)return void this._noMatchesElement.classList.remove("hidden");this._sectionBlocks=await this._rebuildSectionsForMatchedStyleRules(e);let s=[];const n=e.pseudoTypes();n.delete(Protocol.DOM.PseudoType.Before)&&s.push(Protocol.DOM.PseudoType.Before),s=s.concat([...n].sort());for(const t of s){const i=SectionBlock.createPseudoTypeBlock(t);for(const s of e.pseudoStyles(t)){const t=new StylePropertiesSection(this,e,s);i.sections.push(t)}this._sectionBlocks.push(i)}for(const t of e.keyframes()){const i=SectionBlock.createKeyframesBlock(t.name().text);for(const s of t.keyframes())i.sections.push(new KeyframePropertiesSection(this,e,s.style));this._sectionBlocks.push(i)}let r=0;for(const e of this._sectionBlocks){const i=e.titleElement();i&&this._sectionsContainer.appendChild(i);for(const i of e.sections)this._sectionsContainer.appendChild(i.element),r===t&&i.element.focus(),r++}t>=r&&this._sectionBlocks[0].sections[0].element.focus(),this._sectionsContainerFocusChanged(),this._filterRegex?this._updateFilter():this._noMatchesElement.classList.toggle("hidden",this._sectionBlocks.length>0),this._nodeStylesUpdatedForTest(i,!0),this._decorator&&(this._decorator.perform(),this._decorator=null)}_nodeStylesUpdatedForTest(e,t){}async _rebuildSectionsForMatchedStyleRules(e){const t=[new SectionBlock(null)];let i=null;for(const s of e.nodeStyles()){const n=e.isInherited(s)?e.nodeForStyle(s):null;if(n&&n!==i){i=n;const e=await SectionBlock._createInheritedNodeBlock(i);t.push(e)}const r=new StylePropertiesSection(this,e,s);t.peekLast().sections.push(r)}return t}async _createNewRuleInViaInspectorStyleSheet(){const e=this.cssModel(),t=this.node();if(!e||!t)return;this.setUserOperation(!0);const i=await e.requestViaInspectorStylesheet(t);this.setUserOperation(!1),await this._createNewRuleInStyleSheet(i)}async _createNewRuleInStyleSheet(e){if(!e)return;const t=((await e.requestContent()).content||"").split("\n"),i=TextUtils.TextRange.TextRange.createFromLocation(t.length-1,t[t.length-1].length);this._addBlankSection(this._sectionBlocks[0].sections[0],e.id,i)}_addBlankSection(e,t,i){const s=this.node(),n=new BlankStylePropertiesSection(this,e._matchedStyles,s?s.simpleSelector():"",t,i,e._style);this._sectionsContainer.insertBefore(n.element,e.element.nextSibling);for(const t of this._sectionBlocks){const i=t.sections.indexOf(e);-1!==i&&(t.sections.splice(i+1,0,n),n.startEditingSelector())}}removeSection(e){for(const t of this._sectionBlocks){const i=t.sections.indexOf(e);-1!==i&&(t.sections.splice(i,1),e.element.remove())}}filterRegex(){return this._filterRegex}_updateFilter(){let e=!1;for(const t of this._sectionBlocks)e|=t.updateFilter();this._noMatchesElement.classList.toggle("hidden",!!e)}willHide(){this._swatchPopoverHelper.hide(),this._imagePreviewPopover.hide(),super.willHide()}allSections(){let e=[];for(const t of this._sectionBlocks)e=e.concat(t.sections);return e}_clipboardCopy(e){Host.userMetrics.actionTaken(Host.UserMetrics.Action.StyleRuleCopied)}_createStylesSidebarToolbar(){const e=this.contentElement.createChild("div","styles-sidebar-pane-toolbar-container"),t=e.createChild("div","hbox styles-sidebar-pane-toolbar"),i=t.createChild("div","styles-sidebar-pane-filter-box"),s=StylesSidebarPane.createPropertyFilterElement(ls`Filter`,t,this._onFilterChanged.bind(this));UI.ARIAUtils.setAccessibleName(s,Common.UIString.UIString("Filter Styles")),i.appendChild(s);const n=new UI.Toolbar.Toolbar("styles-pane-toolbar",t);n.makeToggledGray(),n.appendItemsAtLocation("styles-sidebarpane-toolbar");return e.createChild("div","styles-sidebar-toolbar-pane-container").createChild("div","styles-sidebar-toolbar-pane")}showToolbarPane(e,t){this._pendingWidgetToggle&&this._pendingWidgetToggle.setToggled(!1),this._pendingWidgetToggle=t,this._animatedToolbarPane?this._pendingWidget=e:this._startToolbarPaneAnimation(e),e&&t&&t.setToggled(!0)}_startToolbarPaneAnimation(e){if(e===this._currentToolbarPane)return;if(e&&this._currentToolbarPane)return this._currentToolbarPane.detach(),e.show(this._toolbarPaneElement),this._currentToolbarPane=e,void this._currentToolbarPane.focus();this._animatedToolbarPane=e,this._currentToolbarPane?this._toolbarPaneElement.style.animationName="styles-element-state-pane-slideout":e&&(this._toolbarPaneElement.style.animationName="styles-element-state-pane-slidein"),e&&e.show(this._toolbarPaneElement);const t=function(){this._toolbarPaneElement.style.removeProperty("animation-name"),this._toolbarPaneElement.removeEventListener("animationend",t,!1),this._currentToolbarPane&&this._currentToolbarPane.detach();this._currentToolbarPane=this._animatedToolbarPane,this._currentToolbarPane&&this._currentToolbarPane.focus();this._animatedToolbarPane=null,this._pendingWidget&&(this._startToolbarPaneAnimation(this._pendingWidget),this._pendingWidget=null)}.bind(this);this._toolbarPaneElement.addEventListener("animationend",t,!1)}}export const _maxLinkLength=23;export class SectionBlock{constructor(e){this._titleElement=e,this.sections=[]}static createPseudoTypeBlock(e){const t=createElement("div");return t.className="sidebar-separator",t.textContent=Common.UIString.UIString("Pseudo ::%s element",e),new SectionBlock(t)}static createKeyframesBlock(e){const t=createElement("div");return t.className="sidebar-separator",t.textContent="@keyframes "+e,new SectionBlock(t)}static async _createInheritedNodeBlock(e){const t=createElement("div");t.className="sidebar-separator",t.createTextChild(ls`Inherited from${" "}`);const i=await Common.Linkifier.Linkifier.linkify(e,{preventKeyboardFocus:!0});return t.appendChild(i),new SectionBlock(t)}updateFilter(){let e=!1;for(const t of this.sections)e|=t._updateFilter();return this._titleElement&&this._titleElement.classList.toggle("hidden",!e),!!e}titleElement(){return this._titleElement}}export class StylePropertiesSection{constructor(e,t,i){this._parentPane=e,this._style=i,this._matchedStyles=t,this.editable=!(!i.styleSheetId||!i.range),this._hoverTimer=null,this._willCauseCancelEditing=!1,this._forceShowAll=!1,this._originalPropertiesCount=i.leadingProperties().length;const s=i.parentRule;this.element=createElementWithClass("div","styles-section matched-styles monospace"),UI.ARIAUtils.setAccessibleName(this.element,this._headerText()+", css selector"),this.element.tabIndex=-1,UI.ARIAUtils.markAsTreeitem(this.element),this.element.addEventListener("keydown",this._onKeyDown.bind(this),!1),this.element._section=this,this._innerElement=this.element.createChild("div"),this._titleElement=this._innerElement.createChild("div","styles-section-title "+(s?"styles-selector":"")),this.propertiesTreeOutline=new UI.TreeOutline.TreeOutlineInShadow,this.propertiesTreeOutline.setFocusable(!1),this.propertiesTreeOutline.registerRequiredCSS("elements/stylesSectionTree.css"),this.propertiesTreeOutline.element.classList.add("style-properties","matched-styles","monospace"),this.propertiesTreeOutline.section=this,this._innerElement.appendChild(this.propertiesTreeOutline.element),this._showAllButton=UI.UIUtils.createTextButton("",this._showAllItems.bind(this),"styles-show-all"),this._innerElement.appendChild(this._showAllButton);const n=createElement("div");this._selectorElement=createElementWithClass("span","selector"),this._selectorElement.textContent=this._headerText(),n.appendChild(this._selectorElement),this._selectorElement.addEventListener("mouseenter",this._onMouseEnterSelector.bind(this),!1),this._selectorElement.addEventListener("mousemove",e=>e.consume(),!1),this._selectorElement.addEventListener("mouseleave",this._onMouseOutSelector.bind(this),!1);n.createChild("span","sidebar-pane-open-brace").textContent=" {",n.addEventListener("mousedown",this._handleEmptySpaceMouseDown.bind(this),!1),n.addEventListener("click",this._handleSelectorContainerClick.bind(this),!1);const r=this._innerElement.createChild("div","sidebar-pane-closing-brace");if(r.textContent="}",this._createHoverMenuToolbar(r),this._selectorElement.addEventListener("click",this._handleSelectorClick.bind(this),!1),this.element.addEventListener("mousedown",this._handleEmptySpaceMouseDown.bind(this),!1),this.element.addEventListener("click",this._handleEmptySpaceClick.bind(this),!1),this.element.addEventListener("mousemove",this._onMouseMove.bind(this),!1),this.element.addEventListener("mouseleave",this._onMouseLeave.bind(this),!1),this._selectedSinceMouseDown=!1,s)if(s.isUserAgent()||s.isInjected())this.editable=!1;else if(s.styleSheetId){const e=s.cssModel().styleSheetHeaderForId(s.styleSheetId);this.navigable=!e.isAnonymousInlineStyleSheet()}this._mediaListElement=this._titleElement.createChild("div","media-list media-matches"),this._selectorRefElement=this._titleElement.createChild("div","styles-section-subtitle"),this._updateMediaList(),this._updateRuleOrigin(),this._titleElement.appendChild(n),this._selectorContainer=n,this.navigable&&this.element.classList.add("navigable"),this.editable||(this.element.classList.add("read-only"),this.propertiesTreeOutline.element.classList.add("read-only")),this._hoverableSelectorsMode=!1,this._markSelectorMatches(),this.onpopulate()}static createRuleOriginNode(e,t,i){if(!i)return createTextNode("");const s=this._getRuleLocationFromCSSRule(i),n=i.styleSheetId?e.cssModel().styleSheetHeaderForId(i.styleSheetId):null;if(s&&i.styleSheetId&&n&&!n.isAnonymousInlineStyleSheet())return StylePropertiesSection._linkifyRuleLocation(e.cssModel(),t,i.styleSheetId,s);if(i.isUserAgent())return createTextNode(Common.UIString.UIString("user agent stylesheet"));if(i.isInjected())return createTextNode(Common.UIString.UIString("injected stylesheet"));if(i.isViaInspector())return createTextNode(Common.UIString.UIString("via inspector"));if(n&&n.ownerNode){const e=linkifyDeferredNodeReference(n.ownerNode,{preventKeyboardFocus:!0});return e.textContent="<style>",e}return createTextNode("")}static _getRuleLocationFromCSSRule(e){let t=null;return e instanceof SDK.CSSRule.CSSStyleRule?t=e.style.range:e instanceof SDK.CSSRule.CSSKeyframeRule&&(t=e.key().range),t}static tryNavigateToRuleLocation(e,t){if(!t)return;const i=this._getRuleLocationFromCSSRule(t),s=t.styleSheetId?e.cssModel().styleSheetHeaderForId(t.styleSheetId):null;if(i&&t.styleSheetId&&s&&!s.isAnonymousInlineStyleSheet()){const s=this._getCSSSelectorLocation(e.cssModel(),t.styleSheetId,i);this._revealSelectorSource(s,!0)}}static _linkifyRuleLocation(e,t,i,s){const n=this._getCSSSelectorLocation(e,i,s);return t.linkifyCSSLocation(n)}static _getCSSSelectorLocation(e,t,i){const s=e.styleSheetHeaderForId(t),n=s.lineNumberInSource(i.startLine),r=s.columnNumberInSource(i.startLine,i.startColumn);return new SDK.CSSModel.CSSLocation(s,n,r)}_onKeyDown(e){if(!(UI.UIUtils.isEditing()||!this.editable||e.altKey||e.ctrlKey||e.metaKey))switch(e.key){case"Enter":case" ":this._startEditingAtFirstPosition(),e.consume(!0);break;default:1===e.key.length&&this.addNewBlankProperty(0).startEditing()}}_setSectionHovered(e){this.element.classList.toggle("styles-panel-hovered",e),this.propertiesTreeOutline.element.classList.toggle("styles-panel-hovered",e),this._hoverableSelectorsMode!==e&&(this._hoverableSelectorsMode=e,this._markSelectorMatches())}_onMouseLeave(e){this._setSectionHovered(!1),this._parentPane._setActiveProperty(null)}_onMouseMove(e){const t=UI.KeyboardShortcut.KeyboardShortcut.eventHasCtrlOrMeta(e);this._setSectionHovered(t);const i=this.propertiesTreeOutline.treeElementFromEvent(e);i instanceof StylePropertyTreeElement?this._parentPane._setActiveProperty(i):this._parentPane._setActiveProperty(null),!this._selectedSinceMouseDown&&this.element.getComponentSelection().toString()&&(this._selectedSinceMouseDown=!0)}_createHoverMenuToolbar(e){if(!this.editable)return;const t=[],i=new UI.Toolbar.ToolbarButton(Common.UIString.UIString("Add text-shadow"),"largeicon-text-shadow");i.addEventListener(UI.Toolbar.ToolbarButton.Events.Click,this._onInsertShadowPropertyClick.bind(this,"text-shadow")),i.element.tabIndex=-1,t.push(i);const s=new UI.Toolbar.ToolbarButton(Common.UIString.UIString("Add box-shadow"),"largeicon-box-shadow");s.addEventListener(UI.Toolbar.ToolbarButton.Events.Click,this._onInsertShadowPropertyClick.bind(this,"box-shadow")),s.element.tabIndex=-1,t.push(s);const n=new UI.Toolbar.ToolbarButton(Common.UIString.UIString("Add color"),"largeicon-foreground-color");n.addEventListener(UI.Toolbar.ToolbarButton.Events.Click,this._onInsertColorPropertyClick,this),n.element.tabIndex=-1,t.push(n);const r=new UI.Toolbar.ToolbarButton(Common.UIString.UIString("Add background-color"),"largeicon-background-color");r.addEventListener(UI.Toolbar.ToolbarButton.Events.Click,this._onInsertBackgroundColorPropertyClick,this),r.element.tabIndex=-1,t.push(r);let o=null;this._style.parentRule&&(o=new UI.Toolbar.ToolbarButton(Common.UIString.UIString("Insert Style Rule Below"),"largeicon-add"),o.addEventListener(UI.Toolbar.ToolbarButton.Events.Click,this._onNewRuleClick,this),o.element.tabIndex=-1,t.push(o));const l=new UI.Toolbar.Toolbar("sidebar-pane-section-toolbar",e);for(let e=0;e<t.length;++e)l.appendToolbarItem(t[e]);const a=new UI.Toolbar.ToolbarButton("","largeicon-menu");function c(e,t){for(let i=0;i<e.length;++i)e[i].setVisible(t);a.setVisible(!t)}a.element.tabIndex=-1,l.appendToolbarItem(a),c(t,!1),l.element.addEventListener("mouseenter",c.bind(null,t,!0)),l.element.addEventListener("mouseleave",c.bind(null,t,!1)),UI.ARIAUtils.markAsHidden(l.element)}style(){return this._style}_headerText(){const e=this._matchedStyles.nodeForStyle(this._style);return this._style.type===SDK.CSSStyleDeclaration.Type.Inline?this._matchedStyles.isInherited(this._style)?Common.UIString.UIString("Style Attribute"):"element.style":this._style.type===SDK.CSSStyleDeclaration.Type.Attributes?ls`${e.nodeNameInCorrectCase()}[Attributes Style]`:this._style.parentRule.selectorText()}_onMouseOutSelector(){this._hoverTimer&&clearTimeout(this._hoverTimer),SDK.OverlayModel.OverlayModel.hideDOMNodeHighlight()}_onMouseEnterSelector(){this._hoverTimer&&clearTimeout(this._hoverTimer),this._hoverTimer=setTimeout(this._highlight.bind(this),300)}_highlight(e="all"){SDK.OverlayModel.OverlayModel.hideDOMNodeHighlight();const t=this._parentPane.node();if(!t)return;const i=this._style.parentRule?this._style.parentRule.selectorText():void 0;t.domModel().overlayModel().highlightInOverlay({node:t,selectorList:i},e)}firstSibling(){const e=this.element.parentElement;if(!e)return null;let t=e.firstChild;for(;t;){if(t._section)return t._section;t=t.nextSibling}return null}lastSibling(){const e=this.element.parentElement;if(!e)return null;let t=e.lastChild;for(;t;){if(t._section)return t._section;t=t.previousSibling}return null}nextSibling(){let e=this.element;do{e=e.nextSibling}while(e&&!e._section);return e?e._section:null}previousSibling(){let e=this.element;do{e=e.previousSibling}while(e&&!e._section);return e?e._section:null}_onNewRuleClick(e){e.data.consume();const t=this._style.parentRule,i=TextUtils.TextRange.TextRange.createFromLocation(t.style.range.endLine,t.style.range.endColumn+1);this._parentPane._addBlankSection(this,t.styleSheetId,i)}_onInsertShadowPropertyClick(e,t){t.data.consume(!0);const i=this.addNewBlankProperty();i.property.name=e,i.property.value="0 0 black",i.updateTitle();const s=ShadowSwatchPopoverHelper.forTreeElement(i);s&&s.showPopover()}_onInsertColorPropertyClick(e){e.data.consume(!0);const t=this.addNewBlankProperty();t.property.name="color",t.property.value="black",t.updateTitle();const i=ColorSwatchPopoverIcon.forTreeElement(t);i&&i.showPopover()}_onInsertBackgroundColorPropertyClick(e){e.data.consume(!0);const t=this.addNewBlankProperty();t.property.name="background-color",t.property.value="white",t.updateTitle();const i=ColorSwatchPopoverIcon.forTreeElement(t);i&&i.showPopover()}_styleSheetEdited(e){const t=this._style.parentRule;t?t.rebase(e):this._style.rebase(e),this._updateMediaList(),this._updateRuleOrigin()}_createMediaList(e){for(let t=e.length-1;t>=0;--t){const i=e[t];if(!i.text.includes("(")&&"print"!==i.text)continue;const s=this._mediaListElement.createChild("div","media"),n=s.createChild("span"),r=n.createChild("span","media-text");switch(i.source){case SDK.CSSMedia.Source.LINKED_SHEET:case SDK.CSSMedia.Source.INLINE_SHEET:r.textContent=`media="${i.text}"`;break;case SDK.CSSMedia.Source.MEDIA_RULE:{const e=n.createChild("span");n.insertBefore(e,r),e.textContent="@media ",r.textContent=i.text,i.styleSheetId&&(s.classList.add("editable-media"),r.addEventListener("click",this._handleMediaRuleClick.bind(this,i,r),!1));break}case SDK.CSSMedia.Source.IMPORT_RULE:r.textContent="@import "+i.text}}}_updateMediaList(){this._mediaListElement.removeChildren(),this._style.parentRule&&this._style.parentRule instanceof SDK.CSSRule.CSSStyleRule&&this._createMediaList(this._style.parentRule.media)}isPropertyInherited(e){return!!this._matchedStyles.isInherited(this._style)&&!SDK.CSSMetadata.cssMetadata().isPropertyInherited(e)}nextEditableSibling(){let e=this;do{e=e.nextSibling()}while(e&&!e.editable);if(!e)for(e=this.firstSibling();e&&!e.editable;)e=e.nextSibling();return e&&e.editable?e:null}previousEditableSibling(){let e=this;do{e=e.previousSibling()}while(e&&!e.editable);if(!e)for(e=this.lastSibling();e&&!e.editable;)e=e.previousSibling();return e&&e.editable?e:null}refreshUpdate(e){this._parentPane._refreshUpdate(this,e)}_updateVarFunctions(e){let t=this.propertiesTreeOutline.firstChild();for(;t;)t!==e&&t.updateTitleIfComputedValueChanged(),t=t.traverseNextTreeElement(!1,null,!0)}update(e){if(this._selectorElement.textContent=this._headerText(),this._markSelectorMatches(),e)this.onpopulate();else{let e=this.propertiesTreeOutline.firstChild();for(;e;)e.setOverloaded(this._isPropertyOverloaded(e.property)),e=e.traverseNextTreeElement(!1,null,!0)}}_showAllItems(e){e&&e.consume(),this._forceShowAll||(this._forceShowAll=!0,this.onpopulate())}onpopulate(){this._parentPane._setActiveProperty(null),this.propertiesTreeOutline.removeChildren();const e=this._style;let t=0;const i=e.leadingProperties(),s=StylePropertiesSection.MaxProperties+i.length-this._originalPropertiesCount;for(const n of i){if(!this._forceShowAll&&t>=s)break;t++;const i=!!e.longhandProperties(n.name).length,r=this.isPropertyInherited(n.name),o=this._isPropertyOverloaded(n);if(e.parentRule&&e.parentRule.isUserAgent()&&r)continue;const l=new StylePropertyTreeElement(this._parentPane,this._matchedStyles,n,i,r,o,!1);this.propertiesTreeOutline.appendChild(l)}t<i.length?(this._showAllButton.classList.remove("hidden"),this._showAllButton.textContent=ls`Show All Properties (${i.length-t} more)`):this._showAllButton.classList.add("hidden")}_isPropertyOverloaded(e){return this._matchedStyles.propertyState(e)===SDK.CSSMatchedStyles.PropertyState.Overloaded}_updateFilter(){let e=!1;this._showAllItems();for(const t of this.propertiesTreeOutline.rootElement().children())e|=t._updateFilter();const t=this._parentPane.filterRegex(),i=!e&&!!t&&!t.test(this.element.deepTextContent());return this.element.classList.toggle("hidden",i),!i&&this._style.parentRule&&this._markSelectorHighlights(),!i}_markSelectorMatches(){const e=this._style.parentRule;if(!e)return;this._mediaListElement.classList.toggle("media-matches",this._matchedStyles.mediaMatches(this._style));const t=e.selectors.map(e=>e.text),i=this._matchedStyles.matchingSelectors(e),s=new Array(t.length).fill(!1);for(const e of i)s[e]=!0;if(this._parentPane._isEditingStyle)return;const n=this._hoverableSelectorsMode?this._renderHoverableSelectors(t,s):this._renderSimplifiedSelectors(t,s);this._selectorElement.removeChildren(),this._selectorElement.appendChild(n),this._markSelectorHighlights()}_renderHoverableSelectors(e,t){const i=createDocumentFragment();for(let s=0;s<e.length;++s)s&&i.createTextChild(", "),i.appendChild(this._createSelectorElement(e[s],t[s],s));return i}_createSelectorElement(e,t,i){const s=createElementWithClass("span","simple-selector");return s.classList.toggle("selector-matches",t),"number"==typeof i&&(s._selectorIndex=i),s.textContent=e,s}_renderSimplifiedSelectors(e,t){const i=createDocumentFragment();let s=!1,n="";for(let r=0;r<e.length;++r)s!==t[r]&&n&&(i.appendChild(this._createSelectorElement(n,s)),n=""),s=t[r],n+=e[r]+(r===e.length-1?"":", ");return n&&i.appendChild(this._createSelectorElement(n,s)),i}_markSelectorHighlights(){const e=this._selectorElement.getElementsByClassName("simple-selector"),t=this._parentPane.filterRegex();for(let i=0;i<e.length;++i){const s=!!t&&t.test(e[i].textContent);e[i].classList.toggle("filter-match",s)}}_checkWillCancelEditing(){const e=this._willCauseCancelEditing;return this._willCauseCancelEditing=!1,e}_handleSelectorContainerClick(e){!this._checkWillCancelEditing()&&this.editable&&e.target===this._selectorContainer&&(this.addNewBlankProperty(0).startEditing(),e.consume(!0))}addNewBlankProperty(e=this.propertiesTreeOutline.rootElement().childCount()){const t=this._style.newBlankProperty(e),i=new StylePropertyTreeElement(this._parentPane,this._matchedStyles,t,!1,!1,!1,!0);return this.propertiesTreeOutline.insertChild(i,t.index),i}_handleEmptySpaceMouseDown(){this._willCauseCancelEditing=this._parentPane._isEditingStyle,this._selectedSinceMouseDown=!1}_handleEmptySpaceClick(e){if(!this.editable||this.element.hasSelection()||this._checkWillCancelEditing()||this._selectedSinceMouseDown)return;if(e.target.classList.contains("header")||this.element.classList.contains("read-only")||e.target.enclosingNodeOrSelfWithClass("media"))return void e.consume();const t=e.deepElementFromPoint();t.treeElement?this.addNewBlankProperty(t.treeElement.property.index+1).startEditing():this.addNewBlankProperty().startEditing(),e.consume(!0)}_handleMediaRuleClick(e,t,i){if(UI.UIUtils.isBeingEdited(t))return;if(UI.KeyboardShortcut.KeyboardShortcut.eventHasCtrlOrMeta(i)&&this.navigable){const t=e.rawLocation();if(!t)return void i.consume(!0);const s=Bindings.CSSWorkspaceBinding.CSSWorkspaceBinding.instance().rawLocationToUILocation(t);return s&&Common.Revealer.reveal(s),void i.consume(!0)}if(!this.editable)return;const s=new UI.InplaceEditor.Config(this._editingMediaCommitted.bind(this,e),this._editingMediaCancelled.bind(this,t),void 0,this._editingMediaBlurHandler.bind(this));UI.InplaceEditor.InplaceEditor.startEditing(t,s),t.getComponentSelection().selectAllChildren(t),this._parentPane.setEditingStyle(!0);t.enclosingNodeOrSelfWithClass("media").classList.add("editing-media"),i.consume(!0)}_editingMediaFinished(e){this._parentPane.setEditingStyle(!1);e.enclosingNodeOrSelfWithClass("media").classList.remove("editing-media")}_editingMediaCancelled(e){this._editingMediaFinished(e),this._markSelectorMatches(),e.getComponentSelection().collapse(e,0)}_editingMediaBlurHandler(e,t){return!0}_editingMediaCommitted(e,t,i,s,n,r){this._parentPane.setEditingStyle(!1),this._editingMediaFinished(t),i&&(i=i.trim()),this._parentPane.setUserOperation(!0);const o=this._parentPane.cssModel();o&&o.setMediaText(e.styleSheetId,e.range,i).then(function(e){e&&(this._matchedStyles.resetActiveProperties(),this._parentPane._refreshUpdate(this)),this._parentPane.setUserOperation(!1),this._editingMediaTextCommittedForTest()}.bind(this))}_editingMediaTextCommittedForTest(){}_handleSelectorClick(e){if(UI.KeyboardShortcut.KeyboardShortcut.eventHasCtrlOrMeta(e)&&this.navigable&&e.target.classList.contains("simple-selector"))return this._navigateToSelectorSource(e.target._selectorIndex,!0),void e.consume(!0);this.element.hasSelection()||(this._startEditingAtFirstPosition(),e.consume(!0))}_navigateToSelectorSource(e,t){const i=this._parentPane.cssModel();if(!i)return;const s=this._style.parentRule,n=i.styleSheetHeaderForId(s.styleSheetId);if(!n)return;const r=new SDK.CSSModel.CSSLocation(n,s.lineNumberInSource(e),s.columnNumberInSource(e));StylePropertiesSection._revealSelectorSource(r,t)}static _revealSelectorSource(e,t){const i=Bindings.CSSWorkspaceBinding.CSSWorkspaceBinding.instance().rawLocationToUILocation(e);i&&Common.Revealer.reveal(i,!t)}_startEditingAtFirstPosition(){this.editable&&(this._style.parentRule?this.startEditingSelector():this.moveEditorFromSelector("forward"))}startEditingSelector(){const e=this._selectorElement;if(UI.UIUtils.isBeingEdited(e))return;e.scrollIntoViewIfNeeded(!1),e.textContent=e.textContent.replace(/\s+/g," ").trim();const t=new UI.InplaceEditor.Config(this.editingSelectorCommitted.bind(this),this.editingSelectorCancelled.bind(this));UI.InplaceEditor.InplaceEditor.startEditing(this._selectorElement,t),e.getComponentSelection().selectAllChildren(e),this._parentPane.setEditingStyle(!0),e.classList.contains("simple-selector")&&this._navigateToSelectorSource(0,!1)}moveEditorFromSelector(e){if(this._markSelectorMatches(),e)if("forward"===e){let e=this.propertiesTreeOutline.firstChild();for(;e&&e.inherited();)e=e.nextSibling;e?e.startEditing(e.nameElement):this.addNewBlankProperty().startEditing()}else{const e=this.previousEditableSibling();if(!e)return;e.addNewBlankProperty().startEditing()}}editingSelectorCommitted(e,t,i,s,n){if(this._editingSelectorEnded(),t&&(t=t.trim()),t===i)return this._selectorElement.textContent=t,void this.moveEditorFromSelector(n);const r=this._style.parentRule;r&&(this._parentPane.setUserOperation(!0),this._setHeaderText(r,t).then(function(){this._parentPane.setUserOperation(!1),this.moveEditorFromSelector(n),this._editingSelectorCommittedForTest()}.bind(this)))}_setHeaderText(e,t){function i(e){const t=this._matchedStyles.matchingSelectors(e).length>0;this.propertiesTreeOutline.element.classList.toggle("no-affect",!t),this._matchedStyles.resetActiveProperties(),this._parentPane._refreshUpdate(this)}console.assert(e instanceof SDK.CSSRule.CSSStyleRule);const s=e.selectorRange();return s?e.setSelectorText(t).then(function(e,t){return t?this._matchedStyles.recomputeMatchingSelectors(e).then(i.bind(this,e)):Promise.resolve()}.bind(this,e,s)):Promise.resolve()}_editingSelectorCommittedForTest(){}_updateRuleOrigin(){this._selectorRefElement.removeChildren(),this._selectorRefElement.appendChild(StylePropertiesSection.createRuleOriginNode(this._matchedStyles,this._parentPane._linkifier,this._style.parentRule))}_editingSelectorEnded(){this._parentPane.setEditingStyle(!1)}editingSelectorCancelled(){this._editingSelectorEnded(),this._markSelectorMatches()}}StylePropertiesSection.MaxProperties=50;export class BlankStylePropertiesSection extends StylePropertiesSection{constructor(e,t,i,s,n,r){const o=e.cssModel();super(e,t,SDK.CSSRule.CSSStyleRule.createDummyRule(o,i).style),this._normal=!1,this._ruleLocation=n,this._styleSheetId=s,this._selectorRefElement.removeChildren(),this._selectorRefElement.appendChild(StylePropertiesSection._linkifyRuleLocation(o,this._parentPane._linkifier,s,this._actualRuleLocation())),r&&r.parentRule&&this._createMediaList(r.parentRule.media),this.element.classList.add("blank-section")}_actualRuleLocation(){const e=this._rulePrefix().split("\n"),t=new TextUtils.TextRange.TextRange(0,0,e.length-1,e.peekLast().length);return this._ruleLocation.rebaseAfterTextEdit(TextUtils.TextRange.TextRange.createFromLocation(0,0),t)}_rulePrefix(){return 0===this._ruleLocation.startLine&&0===this._ruleLocation.startColumn?"":"\n\n"}get isBlank(){return!this._normal}editingSelectorCommitted(e,t,i,s,n){if(!this.isBlank)return void super.editingSelectorCommitted(e,t,i,s,n);function r(e){const t=this._matchedStyles.matchingSelectors(e).length>0;this._makeNormal(e),t||this.propertiesTreeOutline.element.classList.add("no-affect"),this._updateRuleOrigin(),this._parentPane.setUserOperation(!1),this._editingSelectorEnded(),this.element.parentElement&&this.moveEditorFromSelector(n),this._markSelectorMatches(),this._editingSelectorCommittedForTest()}t&&(t=t.trim()),this._parentPane.setUserOperation(!0);const o=this._parentPane.cssModel(),l=this._rulePrefix()+t+" {}";o&&o.addRule(this._styleSheetId,l,this._ruleLocation).then(function(e){return e?this._matchedStyles.addNewRule(e,this._matchedStyles.node()).then(r.bind(this,e)):(this.editingSelectorCancelled(),this._editingSelectorCommittedForTest(),Promise.resolve())}.bind(this))}editingSelectorCancelled(){this._parentPane.setUserOperation(!1),this.isBlank?(this._editingSelectorEnded(),this._parentPane.removeSection(this)):super.editingSelectorCancelled()}_makeNormal(e){this.element.classList.remove("blank-section"),this._style=e.style,this._normal=!0}}export class KeyframePropertiesSection extends StylePropertiesSection{constructor(e,t,i){super(e,t,i),this._selectorElement.className="keyframe-key"}_headerText(){return this._style.parentRule.key().text}_setHeaderText(e,t){console.assert(e instanceof SDK.CSSRule.CSSKeyframeRule);return e.key().range?e.setKeyText(t).then(function(e){e&&this._parentPane._refreshUpdate(this)}.bind(this)):Promise.resolve()}isPropertyInherited(e){return!1}_isPropertyOverloaded(e){return!1}_markSelectorHighlights(){}_markSelectorMatches(){this._selectorElement.textContent=this._style.parentRule.key().text}_highlight(){}}export class CSSPropertyPrompt extends UI.TextPrompt.TextPrompt{constructor(e,t){if(super(),this.initialize(this._buildPropertyCompletions.bind(this),UI.UIUtils.StyleValueDelimiters),this._isColorAware=SDK.CSSMetadata.cssMetadata().isColorAwareProperty(e.property.name),this._cssCompletions=[],t?(this._cssCompletions=SDK.CSSMetadata.cssMetadata().allProperties(),e.node().isSVGNode()||(this._cssCompletions=this._cssCompletions.filter(e=>!SDK.CSSMetadata.cssMetadata().isSVGProperty(e)))):this._cssCompletions=SDK.CSSMetadata.cssMetadata().propertyValues(e.nameElement.textContent),this._treeElement=e,this._isEditingName=t,this._cssVariables=e.matchedStyles().availableCSSVariables(e.property.ownerStyle),this._cssVariables.length<1e3?this._cssVariables.sort(String.naturalOrderComparator):this._cssVariables.sort(),!t&&(this.disableDefaultSuggestionForEmptyInput(),e&&e.valueElement)){const t=e.valueElement.textContent,i=Host.Platform.isMac()?"Cmd":"Ctrl";t.match(/#[\da-f]{3,6}$/i)?this.setTitle(ls`Increment/decrement with mousewheel or up/down keys. ${i}: R ±1, Shift: G ±1, Alt: B ±1`):t.match(/\d+/)&&this.setTitle(ls`Increment/decrement with mousewheel or up/down keys. ${i}: ±100, Shift: ±10, Alt: ±0.1`)}}onKeyDown(e){switch(e.key){case"ArrowUp":case"ArrowDown":case"PageUp":case"PageDown":if(!this.isSuggestBoxVisible()&&this._handleNameOrValueUpDown(e))return void e.preventDefault();break;case"Enter":if(e.shiftKey)return;return this.tabKeyPressed(),void e.preventDefault()}super.onKeyDown(e)}onMouseWheel(e){this._handleNameOrValueUpDown(e)?e.consume(!0):super.onMouseWheel(e)}tabKeyPressed(){return this.acceptAutoComplete(),!1}_handleNameOrValueUpDown(e){return!(this._isEditingName||!this._treeElement.valueElement||!UI.UIUtils.handleElementValueModifications(e,this._treeElement.valueElement,function(e,t){this._treeElement.applyStyleText(this._treeElement.nameElement.textContent+": "+this._treeElement.valueElement.textContent,!1)}.bind(this),this._isValueSuggestion.bind(this),function(e,t,i){return 0!==t&&!i.length&&SDK.CSSMetadata.cssMetadata().isLengthProperty(this._treeElement.property.name)&&(i="px"),e+t+i}.bind(this)))}_isValueSuggestion(e){return!!e&&(e=e.toLowerCase(),-1!==this._cssCompletions.indexOf(e)||e.startsWith("--"))}_buildPropertyCompletions(e,t,i){const s=t.toLowerCase(),n=!this._isEditingName&&e.trim().endsWith("var(");if(!t&&!i&&!n&&(this._isEditingName||e))return Promise.resolve([]);const r=[],o=[];if(n||this._cssCompletions.forEach(e=>c.call(this,e,!1)),this._isEditingName){SDK.CSSMetadata.cssMetadata().nameValuePresets(this._treeElement.node().isSVGNode()).forEach(e=>c.call(this,e,!1,!0))}(this._isEditingName||n)&&this._cssVariables.forEach(e=>c.call(this,e,!0));const l=r.concat(o);!this._isEditingName&&!l.length&&t.length>1&&"!important".startsWith(s)&&l.push({text:"!important"});const a=t.replace("-","");if(a&&a===a.toUpperCase())for(let e=0;e<l.length;++e)l[e].text.startsWith("--")||(l[e].text=l[e].text.toUpperCase());return l.forEach(e=>{if(n)return e.title=e.text,void(e.text+=")");const t=SDK.CSSMetadata.cssMetadata().getValuePreset(this._treeElement.name,e.text);!this._isEditingName&&t&&(e.title=e.text,e.text=t.text,e.selectionRange={startColumn:t.startColumn,endColumn:t.endColumn})}),this._isColorAware&&!this._isEditingName&&l.sort((e,t)=>!!e.subtitleRenderer==!!t.subtitleRenderer?0:e.subtitleRenderer?-1:1),Promise.resolve(l);function c(e,t,i){const n=e.toLowerCase().indexOf(s),l={text:e};if(t){const t=this._treeElement.matchedStyles().computeCSSVariable(this._treeElement.property.ownerStyle,e);if(t){const e=Common.Color.Color.parse(t);e&&(l.subtitleRenderer=h.bind(null,e))}}i&&(l.hideGhostText=!0),0===n?(l.priority=this._isEditingName?SDK.CSSMetadata.cssMetadata().propertyUsageWeight(e):1,r.push(l)):n>-1&&o.push(l)}function h(e){const t=InlineEditor.ColorSwatch.ColorSwatch.create();return t.hideText(!0),t.setColor(e),t.style.pointerEvents="none",t}}}export class StylesSidebarPropertyRenderer{constructor(e,t,i,s){this._rule=e,this._node=t,this._propertyName=i,this._propertyValue=s,this._colorHandler=null,this._bezierHandler=null,this._shadowHandler=null,this._gridHandler=null,this._varHandler=createTextNode}setColorHandler(e){this._colorHandler=e}setBezierHandler(e){this._bezierHandler=e}setShadowHandler(e){this._shadowHandler=e}setGridHandler(e){this._gridHandler=e}setVarHandler(e){this._varHandler=e}renderName(){const e=createElement("span");return e.className="webkit-css-property",e.textContent=this._propertyName,e.normalize(),e}renderValue(){const e=createElement("span");if(e.className="value",!this._propertyValue)return e;const t=SDK.CSSMetadata.cssMetadata();if(this._shadowHandler&&t.isShadowProperty(this._propertyName)&&!SDK.CSSMetadata.VariableRegex.test(this._propertyValue))return e.appendChild(this._shadowHandler(this._propertyValue,this._propertyName)),e.normalize(),e;if(this._gridHandler&&t.isGridAreaDefiningProperty(this._propertyName))return e.appendChild(this._gridHandler(this._propertyValue,this._propertyName)),e.normalize(),e;t.isStringProperty(this._propertyName)&&(e.title=unescapeCssString(this._propertyValue));const i=[SDK.CSSMetadata.VariableRegex,SDK.CSSMetadata.URLRegex],s=[this._varHandler,this._processURL.bind(this)];this._bezierHandler&&t.isBezierAwareProperty(this._propertyName)&&(i.push(UI.Geometry.CubicBezier.Regex),s.push(this._bezierHandler)),this._colorHandler&&t.isColorAwareProperty(this._propertyName)&&(i.push(Common.Color.Regex),s.push(this._colorHandler));const n=TextUtils.TextUtils.Utils.splitStringByRegexes(this._propertyValue,i);for(let t=0;t<n.length;t++){const i=n[t],r=-1===i.regexIndex?createTextNode:s[i.regexIndex];e.appendChild(r(i.value))}return e.normalize(),e}_processURL(e){let t=e.substring(4,e.length-1).trim();(/^'.*'$/s.test(t)||/^".*"$/s.test(t))&&(t=t.substring(1,t.length-1));const i=createDocumentFragment();i.createTextChild("url(");let s=null;this._rule&&this._rule.resourceURL()?s=Common.ParsedURL.ParsedURL.completeURL(this._rule.resourceURL(),t):this._node&&(s=this._node.resolveURL(t));const n=ImagePreviewPopover.setImageUrl(Components.Linkifier.Linkifier.linkifyURL(s||t,{text:t,preventClick:!0,bypassURLTrimming:!0}),t);return i.appendChild(n),i.createTextChild(")"),i}}export class ButtonProvider{constructor(){this._button=new UI.Toolbar.ToolbarButton(Common.UIString.UIString("New Style Rule"),"largeicon-add"),this._button.addEventListener(UI.Toolbar.ToolbarButton.Events.Click,this._clicked,this);const e=UI.Icon.Icon.create("largeicon-longclick-triangle","long-click-glyph");function t(){let e=self.UI.context.flavor(SDK.DOMModel.DOMNode);e=e?e.enclosingElementOrSelf():null,this._button.setEnabled(!!e)}this._button.element.appendChild(e),new UI.UIUtils.LongClickController(this._button.element,this._longClicked.bind(this)),self.UI.context.addFlavorChangeListener(SDK.DOMModel.DOMNode,t.bind(this)),t.call(this)}_clicked(e){StylesSidebarPane._instance._createNewRuleInViaInspectorStyleSheet()}_longClicked(e){StylesSidebarPane._instance._onAddButtonLongClick(e)}item(){return this._button}}