import*as SDK from"../sdk/sdk.js";export class AccessibilityNode{constructor(e,d){this._accessibilityModel=e,this._agent=e._agent,this._id=d.nodeId,e._setAXNodeForAXId(this._id,this),d.backendDOMNodeId?(e._setAXNodeForBackendDOMNodeId(d.backendDOMNodeId,this),this._backendDOMNodeId=d.backendDOMNodeId,this._deferredDOMNode=new SDK.DOMModel.DeferredDOMNode(e.target(),d.backendDOMNodeId)):(this._backendDOMNodeId=null,this._deferredDOMNode=null),this._ignored=d.ignored,this._ignored&&"ignoredReasons"in d&&(this._ignoredReasons=d.ignoredReasons),this._role=d.role||null,this._name=d.name||null,this._description=d.description||null,this._value=d.value||null,this._properties=d.properties||null,this._childIds=d.childIds||null,this._parentNode=null}accessibilityModel(){return this._accessibilityModel}ignored(){return this._ignored}ignoredReasons(){return this._ignoredReasons||null}role(){return this._role||null}coreProperties(){const e=[];return this._name&&e.push({name:"name",value:this._name}),this._description&&e.push({name:"description",value:this._description}),this._value&&e.push({name:"value",value:this._value}),e}name(){return this._name||null}description(){return this._description||null}value(){return this._value||null}properties(){return this._properties||null}parentNode(){return this._parentNode}_setParentNode(e){this._parentNode=e}isDOMNode(){return!!this._backendDOMNodeId}backendDOMNodeId(){return this._backendDOMNodeId}deferredDOMNode(){return this._deferredDOMNode}highlightDOMNode(){this.deferredDOMNode()&&this.deferredDOMNode().highlight()}children(){const e=[];if(!this._childIds)return e;for(const d of this._childIds){const i=this._accessibilityModel.axNodeForId(d);i&&e.push(i)}return e}numChildren(){return this._childIds?this._childIds.length:0}hasOnlyUnloadedChildren(){return!(!this._childIds||!this._childIds.length)&&!this._childIds.some(e=>void 0!==this._accessibilityModel.axNodeForId(e))}printSelfAndChildren(e,d){let i=d||"";this._role?i+=this._role.value:i+="<no role>",i+=this._name?" "+this._name.value:"",i+=" "+this._id,this._domNode&&(i+=" ("+this._domNode.nodeName()+")"),this===e&&(i+=" *");for(const t of this.children())i+="\n"+t.printSelfAndChildren(e,(d||"")+"  ");return i}}export class AccessibilityModel extends SDK.SDKModel.SDKModel{constructor(e){super(e),this._agent=e.accessibilityAgent(),this._axIdToAXNode=new Map,this._backendDOMNodeIdToAXNode=new Map}clear(){this._axIdToAXNode.clear()}async requestPartialAXTree(e){const d=await this._agent.getPartialAXTree(e.id,void 0,void 0,!0);if(d){for(const e of d)new AccessibilityNode(this,e);for(const e of this._axIdToAXNode.values())for(const d of e.children())d._setParentNode(e)}}axNodeForId(e){return this._axIdToAXNode.get(e)}_setAXNodeForAXId(e,d){this._axIdToAXNode.set(e,d)}axNodeForDOMNode(e){return e?this._backendDOMNodeIdToAXNode.get(e.backendNodeId()):null}_setAXNodeForBackendDOMNodeId(e,d){this._backendDOMNodeIdToAXNode.set(e,d)}logTree(e){let d=e;for(;d.parentNode();)d=d.parentNode();console.log(d.printSelfAndChildren(e))}}SDK.SDKModel.SDKModel.register(AccessibilityModel,SDK.SDKModel.Capability.DOM,!1);